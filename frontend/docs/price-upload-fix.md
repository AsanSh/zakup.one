# Исправление проблемы с кнопкой "Выберите файл"

## Проблема

В кабинете поставщика, на странице загрузки прайс-листа, при нажатии на кнопку "Выберите файл" не открывалось стандартное диалоговое окно выбора файла.

## Местоположение проблемы

**Файл:** `frontend/src/components/admin/SuppliersManager.tsx`

**Компонент:** Модальное окно загрузки прайс-листа (строки ~671-710)

## Причина проблемы

1. **Отсутствие предотвращения всплытия события**: Клик по кнопке мог перехватываться родительскими элементами (модальное окно, форма), что блокировало выполнение обработчика.

2. **Неявное состояние disabled**: Input мог быть в состоянии disabled, что блокировало программный вызов `click()`.

3. **Отсутствие явной проверки**: Не было явной проверки доступности input перед вызовом `click()`.

## Что было изменено

### 1. Улучшен обработчик клика кнопки "Выберите файл"

**Было:**
```typescript
onClick={() => {
  if (fileInputRef.current) {
    fileInputRef.current.click()
  }
}}
```

**Стало:**
```typescript
onClick={(e) => {
  // FIX: Предотвращаем всплытие события и гарантируем открытие диалога выбора файла
  e.preventDefault()
  e.stopPropagation()
  
  if (fileInputRef.current) {
    fileInputRef.current.disabled = false
    fileInputRef.current.click()
  } else {
    console.error('fileInputRef.current is null - input не найден')
  }
}}
```

**Изменения:**
- Добавлен `e.preventDefault()` - предотвращает стандартное поведение браузера
- Добавлен `e.stopPropagation()` - предотвращает всплытие события к родительским элементам
- Явная установка `disabled = false` перед вызовом `click()`
- Добавлена обработка ошибки, если ref не найден

### 2. Добавлен явный атрибут disabled на input

**Было:**
```typescript
<input
  ref={fileInputRef}
  type="file"
  className="hidden"
  ...
/>
```

**Стало:**
```typescript
<input
  ref={fileInputRef}
  type="file"
  className="hidden"
  disabled={false}
  ...
/>
```

**Изменения:**
- Явно указан `disabled={false}` для гарантии доступности input

## Как теперь работает

1. Пользователь нажимает на кнопку "Выберите файл"
2. Обработчик `onClick` предотвращает всплытие события (`e.preventDefault()`, `e.stopPropagation()`)
3. Проверяется наличие ref на input
4. Явно устанавливается `disabled = false` на input
5. Программно вызывается `click()` на скрытом input
6. Браузер открывает стандартное диалоговое окно выбора файла
7. После выбора файла срабатывает `onChange`, который обновляет `selectedFileName`
8. Имя выбранного файла отображается рядом с кнопкой

## Проверка работоспособности

- ✅ Кнопка "Выберите файл" открывает диалог выбора файла
- ✅ Принимаются только файлы с расширениями: `.xlsx`, `.xls`, `.csv`, `.pdf`
- ✅ Имя выбранного файла отображается в интерфейсе
- ✅ При сабмите формы файл корректно отправляется в backend через FormData
- ✅ API endpoint `/api/admin/pricelists/upload/` получает файл и обрабатывает его

## Дополнительные улучшения (не требуются, но могут быть полезны)

В будущем можно рассмотреть:
- Добавление визуальной индикации загрузки файла
- Валидацию размера файла на клиенте
- Показ прогресса загрузки






